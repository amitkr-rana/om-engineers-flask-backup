{% extends "admin/base.html" %}

{% block title %}Services - Admin Panel{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-6);">
    <h1>Services Management</h1>
    <a href="{{ url_for('admin.new_service') }}" class="btn btn-primary">üîß Add Service</a>
</div>

<!-- Filters -->
<div class="filters">
    <form method="GET" style="display: flex; gap: var(--space-4); align-items: end; flex-wrap: wrap; width: 100%;">
        <div style="flex: 1; min-width: 200px;">
            <label for="search" class="form-label">Search</label>
            <input type="text" id="search" name="search" class="form-input"
                   placeholder="Name or description" value="{{ search }}">
        </div>
        <div style="min-width: 150px;">
            <label for="category" class="form-label">Category</label>
            <select id="category" name="category" class="form-input">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat }}" {% if cat == current_category %}selected{% endif %}>{{ cat }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Search</button>
        {% if search or current_category %}
        <a href="{{ url_for('admin.services') }}" class="btn btn-secondary">Clear</a>
        {% endif %}
    </form>
</div>

<!-- Services Table -->
{% if services.items %}
<div class="card">
    <table class="admin-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Category</th>
                <th>Duration</th>
                <th>Price Range</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for service in services.items %}
            <tr>
                <td>{{ service.id }}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: var(--space-2);">
                        <span style="font-size: var(--font-size-lg);">{{ service.icon }}</span>
                        <span>{{ service.name }}</span>
                    </div>
                </td>
                <td>{{ service.category }}</td>
                <td>{{ service.duration }}</td>
                <td>{{ service.price_range }}</td>
                <td>
                    <span style="background-color:
                        {% if service.is_active %}var(--success-color){% else %}var(--gray-400){% endif %};
                        color: var(--white); padding: var(--space-1) var(--space-2); border-radius: var(--border-radius-sm); font-size: var(--font-size-xs);">
                        {% if service.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                </td>
                <td>{{ service.created_at.strftime('%m/%d/%Y') }}</td>
                <td>
                    <div style="display: flex; gap: var(--space-2);">
                        <a href="{{ url_for('admin.edit_service', service_id=service.id) }}"
                           class="btn btn-sm btn-outline">‚úèÔ∏è Edit</a>
                        <form method="POST" action="{{ url_for('admin.delete_service', service_id=service.id) }}"
                              style="display: inline;"
                              onsubmit="return confirm('Are you sure you want to delete this service? This will also affect related appointments!')">
                            <button type="submit" class="btn btn-sm btn-danger">üóëÔ∏è Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if services.pages > 1 %}
<div class="pagination">
    {% if services.has_prev %}
        <a href="{{ url_for('admin.services', page=services.prev_num, search=search, category=current_category) }}">¬´ Previous</a>
    {% endif %}

    {% for page_num in services.iter_pages() %}
        {% if page_num %}
            {% if page_num != services.page %}
                <a href="{{ url_for('admin.services', page=page_num, search=search, category=current_category) }}">{{ page_num }}</a>
            {% else %}
                <span class="current">{{ page_num }}</span>
            {% endif %}
        {% else %}
            <span>‚Ä¶</span>
        {% endif %}
    {% endfor %}

    {% if services.has_next %}
        <a href="{{ url_for('admin.services', page=services.next_num, search=search, category=current_category) }}">Next ¬ª</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="card" style="text-align: center; padding: var(--space-16);">
    <div style="font-size: var(--font-size-3xl); margin-bottom: var(--space-4);">üîß</div>
    <h3 style="color: var(--gray-600); margin-bottom: var(--space-4);">No services found</h3>
    {% if search or current_category %}
    <p style="color: var(--gray-500); margin-bottom: var(--space-6);">
        No services match your filters.
    </p>
    <a href="{{ url_for('admin.services') }}" class="btn btn-secondary">Clear Filters</a>
    {% else %}
    <p style="color: var(--gray-500); margin-bottom: var(--space-6);">
        Get started by adding your first service.
    </p>
    <a href="{{ url_for('admin.new_service') }}" class="btn btn-primary">Add First Service</a>
    {% endif %}
</div>
{% endif %}

<!-- Summary -->
<div style="margin-top: var(--space-8); padding: var(--space-4); background: var(--gray-50); border-radius: var(--border-radius);">
    <p style="margin: 0; color: var(--gray-600); font-size: var(--font-size-sm);">
        Showing {{ services.items|length }} of {{ services.total }} services
        {% if search %}matching "{{ search }}"{% endif %}
        {% if current_category %}in "{{ current_category }}"{% endif %}
    </p>
</div>
{% endblock %}