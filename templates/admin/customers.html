{% extends "admin/base.html" %}

{% block title %}Customers - Admin Panel{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-6);">
    <h1>Customers Management</h1>
    <a href="{{ url_for('admin.new_customer') }}" class="btn btn-primary">➕ Add Customer</a>
</div>

<!-- Filters -->
<div class="filters">
    <form method="GET" style="display: flex; gap: var(--space-4); align-items: end; flex-wrap: wrap; width: 100%;">
        <div style="flex: 1; min-width: 200px;">
            <label for="search" class="form-label">Search</label>
            <input type="text" id="search" name="search" class="form-input"
                   placeholder="Name, email, or phone" value="{{ search }}">
        </div>
        <button type="submit" class="btn btn-primary">Search</button>
        {% if search %}
        <a href="{{ url_for('admin.customers') }}" class="btn btn-secondary">Clear</a>
        {% endif %}
    </form>
</div>

<!-- Customers Table -->
{% if customers.items %}
<div class="card">
    <table class="admin-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Created</th>
                <th>Appointments</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in customers.items %}
            <tr>
                <td>{{ customer.id }}</td>
                <td>{{ customer.name }}</td>
                <td>{{ customer.email }}</td>
                <td>{{ customer.phone }}</td>
                <td>{{ customer.created_at.strftime('%m/%d/%Y') }}</td>
                <td>{{ customer.appointments|length }}</td>
                <td>
                    <div style="display: flex; gap: var(--space-2);">
                        <a href="{{ url_for('admin.edit_customer', customer_id=customer.id) }}"
                           class="btn btn-sm btn-outline">✏️ Edit</a>
                        <form method="POST" action="{{ url_for('admin.delete_customer', customer_id=customer.id) }}"
                              style="display: inline;"
                              onsubmit="return confirm('Are you sure you want to delete this customer? This will also delete all their appointments!')">
                            <button type="submit" class="btn btn-sm btn-danger">🗑️ Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if customers.pages > 1 %}
<div class="pagination">
    {% if customers.has_prev %}
        <a href="{{ url_for('admin.customers', page=customers.prev_num, search=search) }}">« Previous</a>
    {% endif %}

    {% for page_num in customers.iter_pages() %}
        {% if page_num %}
            {% if page_num != customers.page %}
                <a href="{{ url_for('admin.customers', page=page_num, search=search) }}">{{ page_num }}</a>
            {% else %}
                <span class="current">{{ page_num }}</span>
            {% endif %}
        {% else %}
            <span>…</span>
        {% endif %}
    {% endfor %}

    {% if customers.has_next %}
        <a href="{{ url_for('admin.customers', page=customers.next_num, search=search) }}">Next »</a>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="card" style="text-align: center; padding: var(--space-16);">
    <div style="font-size: var(--font-size-3xl); margin-bottom: var(--space-4);">👥</div>
    <h3 style="color: var(--gray-600); margin-bottom: var(--space-4);">No customers found</h3>
    {% if search %}
    <p style="color: var(--gray-500); margin-bottom: var(--space-6);">
        No customers match your search for "{{ search }}".
    </p>
    <a href="{{ url_for('admin.customers') }}" class="btn btn-secondary">Clear Search</a>
    {% else %}
    <p style="color: var(--gray-500); margin-bottom: var(--space-6);">
        Get started by adding your first customer.
    </p>
    <a href="{{ url_for('admin.new_customer') }}" class="btn btn-primary">Add First Customer</a>
    {% endif %}
</div>
{% endif %}

<!-- Summary -->
<div style="margin-top: var(--space-8); padding: var(--space-4); background: var(--gray-50); border-radius: var(--border-radius);">
    <p style="margin: 0; color: var(--gray-600); font-size: var(--font-size-sm);">
        Showing {{ customers.items|length }} of {{ customers.total }} customers
        {% if search %}matching "{{ search }}"{% endif %}
    </p>
</div>
{% endblock %}