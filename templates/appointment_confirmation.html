{% extends "base.html" %}

{% block title %}Appointment Confirmed - {{ config.APP_NAME }}{% endblock %}

{% block content %}
<div class="form-fullscreen">
    <div class="form-container" style="text-align: center;">
        <!-- Success Icon -->
        <div style="font-size: 4rem; margin-bottom: var(--space-6);">✅</div>

        <!-- Header -->
        <h1 style="color: var(--success-color); margin-bottom: var(--space-4);">
            {% if appointment.appointment_type.value == 'quotation' %}
                Quotation Request Submitted!
            {% else %}
                Service Appointment Scheduled!
            {% endif %}
        </h1>

        <p style="color: var(--gray-600); font-size: var(--font-size-lg); margin-bottom: var(--space-8);">
            {% if appointment.appointment_type.value == 'quotation' %}
                Thank you for your quotation request. We'll contact you within 2 hours to discuss your project.
            {% else %}
                Your service appointment has been scheduled successfully. We'll be in touch to confirm the details.
            {% endif %}
        </p>

        <!-- Appointment Details Card -->
        <div style="width: 100%;">
            <div class="card" style="padding: var(--space-8);">
                <div style="text-align: center; margin-bottom: var(--space-8);">
                    <h2 style="color: var(--gray-800);">
                        {% if appointment.appointment_type.value == 'quotation' %}
                            Request Details
                        {% else %}
                            Appointment Details
                        {% endif %}
                    </h2>
                    <div style="background-color: var(--primary-color); color: var(--white); padding: var(--space-2) var(--space-4); border-radius: var(--border-radius); display: inline-block; margin-top: var(--space-2);">
                        <strong>Reference #{{ appointment.id }}</strong>
                    </div>
                </div>

                <!-- Customer Information -->
                <div style="margin-bottom: var(--space-8);">
                    <h3 style="color: var(--gray-700); margin-bottom: var(--space-4); border-bottom: 2px solid var(--gray-200); padding-bottom: var(--space-2);">
                        👤 Customer Information
                    </h3>
                    <div style="display: grid; gap: var(--space-3);">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-600);">Name:</span>
                            <span style="font-weight: var(--font-weight-medium);">{{ customer.name }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-600);">Email:</span>
                            <span>{{ customer.email }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-600);">Phone:</span>
                            <span>{{ format_phone(customer.phone) }}</span>
                        </div>
                        {% if appointment.address %}
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <span style="color: var(--gray-600);">Address:</span>
                            <span style="text-align: right; max-width: 60%;">{{ appointment.address }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Service Information -->
                <div style="margin-bottom: var(--space-8);">
                    <h3 style="color: var(--gray-700); margin-bottom: var(--space-4); border-bottom: 2px solid var(--gray-200); padding-bottom: var(--space-2);">
                        🔧 Service Information
                    </h3>
                    <div style="display: grid; gap: var(--space-3);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: var(--gray-600);">Service:</span>
                            <span style="font-weight: var(--font-weight-medium);">
                                {{ service.icon }} {{ service.name }}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-600);">Category:</span>
                            <span>{{ service.category }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-600);">Estimated Duration:</span>
                            <span>{{ service.duration }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-600);">Price Range:</span>
                            <span>{{ service.price_range }}</span>
                        </div>
                        {% if appointment.notes %}
                        <div style="margin-top: var(--space-2); padding-top: var(--space-3); border-top: 1px solid var(--gray-200);">
                            <span style="color: var(--gray-600); font-weight: var(--font-weight-medium);">Notes:</span>
                            <p style="margin-top: var(--space-2); padding: var(--space-3); background-color: var(--gray-50); border-radius: var(--border-radius); margin-bottom: 0;">
                                {{ appointment.notes }}
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Appointment Timing -->
                <div style="margin-bottom: var(--space-8);">
                    <h3 style="color: var(--gray-700); margin-bottom: var(--space-4); border-bottom: 2px solid var(--gray-200); padding-bottom: var(--space-2);">
                        📅
                        {% if appointment.appointment_type.value == 'quotation' %}
                            Preferred Assessment Time
                        {% else %}
                            Appointment Time
                        {% endif %}
                    </h3>
                    <div style="display: grid; gap: var(--space-3);">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-600);">Date:</span>
                            <span style="font-weight: var(--font-weight-medium);">{{ format_date(appointment.appointment_date) }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-600);">Time:</span>
                            <span style="font-weight: var(--font-weight-medium);">{{ format_time(appointment.appointment_time) }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray-600);">Status:</span>
                            <span style="background-color: var(--warning-color); color: var(--white); padding: var(--space-1) var(--space-3); border-radius: var(--border-radius-sm); font-size: var(--font-size-sm);">
                                {{ appointment.status.value.title() }}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Next Steps -->
                <div style="background-color: var(--gray-50); padding: var(--space-6); border-radius: var(--border-radius-lg);">
                    <h3 style="color: var(--primary-color); margin-bottom: var(--space-4);">🎯 What Happens Next?</h3>
                    {% if appointment.appointment_type.value == 'quotation' %}
                    <ol style="margin: 0; padding-left: var(--space-6); color: var(--gray-700);">
                        <li style="margin-bottom: var(--space-2);">We'll contact you within <strong>2 hours</strong> to discuss your project</li>
                        <li style="margin-bottom: var(--space-2);">Schedule a convenient time for our expert to visit your property</li>
                        <li style="margin-bottom: var(--space-2);">Receive a detailed, itemized quotation within <strong>24 hours</strong></li>
                        <li style="margin-bottom: var(--space-2);">Decide if you want to proceed - no pressure, no obligation</li>
                    </ol>
                    {% else %}
                    <ol style="margin: 0; padding-left: var(--space-6); color: var(--gray-700);">
                        <li style="margin-bottom: var(--space-2);">We'll call you within <strong>2 hours</strong> to confirm your appointment</li>
                        <li style="margin-bottom: var(--space-2);">Our technician will arrive at the scheduled time</li>
                        <li style="margin-bottom: var(--space-2);">Service will be completed professionally and efficiently</li>
                        <li style="margin-bottom: var(--space-2);">You'll receive a service completion report and warranty information</li>
                    </ol>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div style="margin-top: var(--space-6);">
            <div style="display: flex; flex-direction: column; gap: var(--space-4); align-items: center;">
                <a href="{{ url_for('main.index') }}" class="btn btn-primary btn-lg">
                    Return to Home
                </a>

                <div style="display: flex; gap: var(--space-4); flex-wrap: wrap; justify-content: center;">
                    <a href="tel:{{ config.CONTACT_PHONE }}" class="btn btn-outline">
                        📞 Call Us
                    </a>
                    <a href="mailto:{{ config.CONTACT_EMAIL }}?subject=Appointment #{{ appointment.id }}" class="btn btn-outline">
                        ✉️ Email Us
                    </a>
                </div>
            </div>
        </div>

        <!-- Important Information -->
        <div style="margin-top: var(--space-6);">
            <div style="background-color: var(--primary-color); color: var(--white); padding: var(--space-4); border-radius: var(--border-radius-lg);">
                <h4 style="color: var(--white); margin-bottom: var(--space-3);">📱 Save Our Contact Information</h4>
                <div style="display: flex; flex-direction: column; gap: var(--space-2); align-items: center;">
                    <div>
                        <strong>Phone:</strong> {{ config.CONTACT_PHONE }}
                    </div>
                    <div>
                        <strong>Email:</strong> {{ config.CONTACT_EMAIL }}
                    </div>
                </div>
                <p style="margin-top: var(--space-4); margin-bottom: 0; font-size: var(--font-size-sm); opacity: 0.9;">
                    Please keep your reference number <strong>#{{ appointment.id }}</strong> handy for all communications.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add animation to success icon
    const successIcon = document.querySelector('div[style*="font-size: 4rem"]');
    if (successIcon) {
        successIcon.style.transform = 'scale(0)';
        successIcon.style.transition = 'transform 0.5s ease-out';

        setTimeout(() => {
            successIcon.style.transform = 'scale(1)';
        }, 200);
    }

    // Announce success for screen readers
    if (window.omEngineers && window.omEngineers.announcePageChange) {
        const appointmentType = '{{ appointment.appointment_type.value }}';
        const message = appointmentType === 'quotation' ?
            'Quotation request submitted successfully' :
            'Service appointment scheduled successfully';

        setTimeout(() => {
            window.omEngineers.announcePageChange(message);
        }, 1000);
    }

    // Auto-save important information to localStorage for user reference
    const appointmentData = {
        id: {{ appointment.id }},
        type: '{{ appointment.appointment_type.value }}',
        service: '{{ service.name }}',
        date: '{{ format_date(appointment.appointment_date) }}',
        time: '{{ format_time(appointment.appointment_time) }}',
        status: '{{ appointment.status.value }}',
        reference: '#{{ appointment.id }}',
        contactPhone: '{{ config.CONTACT_PHONE }}',
        contactEmail: '{{ config.CONTACT_EMAIL }}'
    };

    try {
        const savedAppointments = JSON.parse(localStorage.getItem('omEngineersAppointments') || '[]');
        savedAppointments.unshift(appointmentData);

        // Keep only the last 10 appointments
        if (savedAppointments.length > 10) {
            savedAppointments.splice(10);
        }

        localStorage.setItem('omEngineersAppointments', JSON.stringify(savedAppointments));
    } catch (e) {
        // localStorage not available or full
        console.log('Could not save appointment data to local storage');
    }
});
</script>
{% endblock %}